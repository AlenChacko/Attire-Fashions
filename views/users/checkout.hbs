

    <section class="hero-wrap hero-wrap-2" style="background-image: url('images/bg_2.jpg');" data-stellar-background-ratio="0.5">
      <div class="overlay"></div>
      <div class="container">
        <div class="row no-gutters slider-text align-items-end justify-content-center">
          <div class="col-md-9 ftco-animate mb-5 text-center">
          	<p class="breadcrumbs mb-0"><span class="mr-2"><a href="index.html">Home <i class="fa fa-chevron-right"></i></a></span> <span>Checkout <i class="fa fa-chevron-right"></i></span></p>
            <h2 class="mb-0 bread">Checkout</h2>
          </div>
        </div>
      </div>
    </section>

    <section class="ftco-section">
    	<div class="container">
    		<div class="row justify-content-center">
				<button class="site-btn ml-3 btn-success mt-3" style="border: none; border-radius: 5px;"
							type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false"
							aria-controls="collapseExample">
							Select from Saved Addresses
						</button>
						<div class="collapse col-md-10 col-lg-12" id="collapseExample">
							<div class="d-flex">
							{{#each userAddress.address}}
						
						<div class="card mt-5 m-3 " style="width: 18rem;">
							
							<div class="card-body">
								
								<input type="radio" name="choice" onclick="savedAddressSelect('{{this.name}}','{{this.buildingName}}','{{this.city}}','{{this.pin}}','{{this.phone}}','{{this.email}}','{{this.state}}','{{this.country}}')">
								<h5>{{this.name}},</h5>
								<p>{{this.buildingName}},{{this.city}}, <br> {{this.pin}}, <br>
                                {{this.phone}},{{this.email}} <br> {{this.state}}, {{this.country}}</p>
									
									
							</div>
						</div>
						{{/each}}
						</div>
						</div>
          <div class="col-xl-10 ftco-animate">
						<form action="/place-order" class="billing-form" id="checkout-form">
							<h3 class="mb-4 billing-heading">Billing Details</h3>
	          	<div class="row align-items-end">
	          		<div class="col-md-6">
	                <div class="form-group">
	                	<label for="firstname">Full Name</label>
	                  <input type="text" class="form-control" placeholder="" id="name" name="name"  required>
	                </div>
	              </div>
	              <div class="col-md-6">
	                <div class="form-group">
	                	<label for="lastname">Contact Number</label>
	                  <input type="text" class="form-control inp" placeholder="" id="phone"  name="phone" required>
	                </div>
                </div>
                <div class="w-100"></div>
		            <div class="w-100"></div>
		            <div class="col-md-6">
		            	<div class="form-group">
	                	<label for="streetaddress">Email</label>
	                  <input type="text" class="form-control" placeholder="" id="email" name="email" required>
	                </div>
		            </div>
					<div class="col-md-6">
		            	<div class="form-group">
	                	<label for="streetaddress">Building Name and Number</label>
	                  <input type="text" class="form-control" placeholder="" id="buildingName" name="buildingName" required>
	                </div>
		            </div>
		            <div class="w-100"></div>
		            <div class="col-md-6">
		            	<div class="form-group">
		            		<label for="postcodezip">City/Town</label>
	                  <input type="text" class="form-control" placeholder="" id="city" name="city" required>
	                </div>
		            </div>
					 <div class="col-md-6">
		            	<div class="form-group">
		            		<label for="postcodezip">Pincode</label>
	                  <input type="text" class="form-control inp" placeholder="" id="pin" name="pin" required>
	                </div>
		            </div>
		            <div class="w-100"></div>
		            <div class="col-md-6">
	                <div class="form-group">
	                	<label for="phone">State</label>
	                  <input type="text" class="form-control" placeholder="" id="state" name="state" required>
	                </div>
	              </div>
	              <div class="col-md-6">
	                <div class="form-group">
	                	<label for="emailaddress">Country</label>
	                  <input type="text" class="form-control" placeholder="" id="country" name="country" required>
	                </div>
                </div>
				<input type="text" name="userId" id="" value="{{user._id}}" hidden>
                <div class="w-100"></div>
	            </div>

				<div class="row mt-5 pt-3 d-flex">
	          	<div class="col-md-6 d-flex">
					
	          		<div class="cart-detail cart-total p-3 p-md-4">


						<h3 class="billing-heading mb-4">Your Products</h3>
						{{#each products.cartItems}}
		    					<p class="d-flex">
		    						<span>{{this.product.name}} ({{this.quantity}})</span>
		    						<span>₹ {{this.productTotal}}</span>
		    					</p>
								{{/each}}


	          			<h3 class="billing-heading mb-4">Cart Total</h3>
		    					<p class="d-flex">
		    						<span>Delivery</span>
		    						<span>₹ 100</span>
		    					</p>
								
		    					<hr>
								<p class="d-flex">
		    						<span>Discount</span>
		    						<span id="discount">₹ {{discountPrice}} </span>
		    					</p>
		    					
										{{#if discountPrice}}
										<p class="d-flex total-price">
											<span>Total</span>
											<span> ₹ {{subtotal coupendiscount 100}} </span>
											<input id="GrandTotal" name="GrandTotal" type="number" value="{{subtotal coupendiscount 100}}" hidden>
										</p>
										{{else}}
										<p class="d-flex total-price">
											<span>Total</span>
											<span> ₹ {{subtotal totalAmount 100}}</span>
											 <input id="GrandTotal" name="GrandTotal" type="number" value="{{subtotal totalAmount 100}}" hidden>
										</p>
										{{/if}}
								</div>
	          	</div>
	          	<div class="col-md-6">
	          		<div class="cart-detail p-3 p-md-4">
	          			<h3 class="billing-heading mb-4">Payment Method</h3>
									<div class="form-group">
										<div class="col-md-12">
											<div class="radio">
											   <label><input type="radio" name="payment-method" class="mr-2" value="COD" checked> Cash on Delivery</label>
											</div>
										</div>
									</div>
									<div class="form-group">
										<div class="col-md-12">
											<div class="radio">
											   <label><input type="radio" name="payment-method" class="mr-2" value="ONLINE"> Pay Online</label>
											</div>
										</div>
									</div>
									{{!-- <p><a href="#"class="btn btn-primary py-3 px-4" type="submit">Place an order</a></p> --}}
									<button class="btn btn-success" type="submit">Place an Order</button>
								</div>
	          	</div>
	          </div>

	          </form><!-- END -->



	          
          </div> <!-- .col-md-8 -->
        </div>
    	</div>
    </section>

    <footer class="ftco-footer">
      <div class="container">
        <div class="row mb-5">
          <div class="col-sm-12 col-md">
            <div class="ftco-footer-widget mb-4">
              <h2 class="ftco-heading-2 logo"><a href="#">Attire <span>Fashions</span></a></h2>
              <p>Far far away, behind the word mountains, far from the countries.</p>
              <ul class="ftco-footer-social list-unstyled mt-2">
                <li class="ftco-animate"><a href="#"><span class="fa fa-twitter"></span></a></li>
                <li class="ftco-animate"><a href="#"><span class="fa fa-facebook"></span></a></li>
                <li class="ftco-animate"><a href="#"><span class="fa fa-instagram"></span></a></li>
              </ul>
            </div>
          </div>
          <div class="col-sm-12 col-md">
            <div class="ftco-footer-widget mb-4 ml-md-4">
              <h2 class="ftco-heading-2">My Accounts</h2>
              <ul class="list-unstyled">
                <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>My Account</a></li>
                <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Register</a></li>
                <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Log In</a></li>
                <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>My Order</a></li>
              </ul>
            </div>
          </div>
          <div class="col-sm-12 col-md">
            <div class="ftco-footer-widget mb-4 ml-md-4">
              <h2 class="ftco-heading-2">Information</h2>
              <ul class="list-unstyled">
                <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>About us</a></li>
                <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Catalog</a></li>
                <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Contact us</a></li>
                <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Term &amp; Conditions</a></li>
              </ul>
            </div>
          </div>
          <div class="col-sm-12 col-md">
             <div class="ftco-footer-widget mb-4">
              <h2 class="ftco-heading-2">Quick Link</h2>
              <ul class="list-unstyled">
                <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>New User</a></li>
                <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Help Center</a></li>
                <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Report Spam</a></li>
                <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Faq's</a></li>
              </ul>
            </div>
          </div>
          <div class="col-sm-12 col-md">
            <div class="ftco-footer-widget mb-4">
            	<h2 class="ftco-heading-2">Have a Questions?</h2>
            	<div class="block-23 mb-3">
	              <ul>
	                <li><span class="icon fa fa-map marker"></span><span class="text">203 Fake St. Mountain View, San Francisco, California, USA</span></li>
	                <li><a href="#"><span class="icon fa fa-phone"></span><span class="text">+2 392 3929 210</span></a></li>
	                <li><a href="#"><span class="icon fa fa-paper-plane pr-4"></span><span class="text">info@yourdomain.com</span></a></li>
	              </ul>
	            </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container-fluid px-0 py-5 bg-black">
      	<div class="container">
      		<div class="row">
	          <div class="col-md-12">
		
	            <p class="mb-0" style="color: rgba(255,255,255,.5);"><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
	  Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart color-danger" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib.com</a>
	  <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
	          </div>
	        </div>
      	</div>
      </div>
    </footer>
    
  

  <!-- loader -->
  <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>


{{!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script type="text/javascript"
  src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.js"></script>
<script>
  $("#checkout-form").validate();
</script> --}}

<style>
    .error{
        color: red;
    }
	.inp[type=number] {
  		-moz-appearance: textfield;
	}
	.inp::-webkit-outer-spin-button,
	.inp::-webkit-inner-spin-button {
  		-webkit-appearance: none;
  		margin: 0;
	}
</style>


<script src="https://checkout.razorpay.com/v1/checkout.js"></script>


<script>
    function savedAddressSelect(name,phone,email,buildingName,city,pin,state,country) {
        document.getElementById('name').value = name
        document.getElementById('phone').value = phone
        document.getElementById('email').value = email
        // document.getElementById('Street_Address').value = Street_Address
        // document.getElementById('Extra_Details').value = Extra_Details
        document.getElementById('buildingName').value = buildingName
        document.getElementById('city').value = city
        document.getElementById('pin').value = pin
        document.getElementById('state').value = state
        document.getElementById('country').value = country
    }
</script>

<script>
	$("#checkout-form").submit((e)=>{
		e.preventDefault()
		$.ajax({
			url:'/place-order',
			method:'post',
			data:$('#checkout-form').serialize(),
			success:(response)=>{
				{{!-- Swal.fire({
					icon:'success',
					title:'Your order has been placed',
					showConfirmButton: false,
					timer:1500
				}) --}}
				if(response.CODsuccess){
					location.href = '/order-success'
				}else{
					razorpayPayment(response)
				}
			}
		})
	})
	function razorpayPayment(order){
		var options = {
			"key": "rzp_test_1mc9EUokP0V5Jx", // Enter the Key ID generated from the Dashboard
			"amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
			"currency": "INR",
			"name": "Attire Fashions",
			"description": "Test Transaction",
			"image": "https://example.com/your_logo",
			"order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
			"handler": function (response){
				verifyPayment(response,order)
			},
			"prefill": {
				"name": "Gaurav Kumar",
				"email": "gaurav.kumar@example.com",
				"contact": "9999999999"
			},
			"notes": {
				"address": "Razorpay Corporate Office"
			},
			"theme": {
				"color": "rgb(183, 71, 42)"
			}
		};
		var rzp1 = new Razorpay(options);
		 rzp1.open();
	}
	function verifyPayment(payment,order){
		$.ajax({
			url:'/verify-payment',
			data:{
				payment,
				order
			},
			method:'post',
			success:(response)=>{
				if(response.status){
					location.href = '/order-success'
				}else{
					Swal.fire({
					icon:'warning',
					title:'Payment Failed',
					showConfirmButton: false,
					timer:1500
				})
				}
			}
		})
	}
</script>
 
    
